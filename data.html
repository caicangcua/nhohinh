<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title></title>
</head>
<body>
    <script>
        function comsvr(args, cb) {
            var xhr = new XMLHttpRequest(), url = "/jdata/sp.json";
            xhr.open('GET', url);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send();

            // 4. This will be called after the response is received
            xhr.onload = function () {
                if (xhr.status != 200) { // analyze HTTP status of the response
                    cb({ 'kq': 'ng', 'status': xhr.status, 'statusTex': xhr.statusText });// e.g. 404: Not Found
                } else { // show the result
                    var json = JSON.parse(xhr.responseText);
                    json['kq'] = 'ok';
                    cb(json);
                }
            };
            xhr.onerror = function () {
                cb({ 'kq': 'err' });
            };
        }

        function urlP(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        };
        var trackhwnd, puri = urlP('puri'), dotrack = function () {
            clearTimeout(trackhwnd);
            comsvr({}, function (data) {
                atD = new Date();
                window.parent.postMessage(data, puri);
                trackhwnd = setTimeout(function () { dotrack(); console.log('iframe json data' + atD); }, 30000);
            });
        };

        window.onload = function () {
            var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent", eventer = window[eventMethod],
                messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";

            console.log(puri);
            eventer(messageEvent, function (e) {

                console.log(e.origin);
                if (e.origin !== puri) return;
                dotrack();
            }, false);
        }
    </script>
</body>
</html>