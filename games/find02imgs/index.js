$(function(){function t(t,i){var n=t.find(".digit");if(n.is(":animated"))return!1;if(t.data("digit")==i)return!1;t.data("digit",i);var a=$("<span>",{class:"digit",css:{top:"-2.1em",opacity:0},html:i});n.before(a).removeClass("static").animate({top:"2.5em",opacity:0},"fast",function(){try{n.remove()}catch(t){}}),a.delay(100).animate({top:0,opacity:1},"fast",function(){try{a.addClass("static")}catch(t){}})}var n=function(t){for(var i=t.length-1;i>0;i--){var n=Math.floor(Math.random()*(i+1)),a=t[i];t[i]=t[n],t[n]=a}return t},a=function(){var t=new Date,i=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),n=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();e=i+" "+n},e="",s=void 0,c=void 0,o=0,r=[],d=0,p=!1,u=$(".app__hud"),l=$(".app__hud__game-status"),f=$(".app__cards-container"),m=f.children().first();m.detach();var h,g=["🐵","🐶","🐺","🐱","🐯","🐴","🐮","🐷","🐗","🐭","🐹","🐰","🐻","🐨","🐼","🐔","🐤","🐦","🐧","🐸"],v=function(){if(p)$(".app__cards-container").removeAttr("style");else{var t=window.innerWidth,i=window.innerHeight;t>i?t-=u.width():i-=u.height();var n=Math.min(t,i);$(".app__cards-container").css({width:n+"px"});var a=parseInt(n/4)-20;$(".app__cards-container__card").css({width:a+"px",height:a+"px"})}},y=function(){l.html("Số lần: "+o+", Món: "+d),0===r.length&&(p=!0,w(JSON.stringify({act:"findthesameimg_rst",ncc:"phucky",args:[o,e,u.data("gamekey")]}),function(n,a){if("ok"==n)if("OK"==a.kq){$(".rst").css("display","block"),u.css("display","none"),u.data("gamekey",a.kmkey);var e=$(".rst .pre"),s=$(".rst .button");e.html(a.gamekey.rst+'<div style="position:absolute;right:10px;top:5px"><div id="countdown" class="countdownHolder"></div></div>'),s.html(a.gamekey.giamgia+'<div class="giamgia"></div><div class="giamgia"></div><div class="giamgia"></div>').click(function(t){args.cb("DATHANG",{kmkey:a.kmkey})}),function(n,a){var e,s,c,o,r,d,p={callback:function(){},timestamp:0,isPause:!1};for(i in a)a.hasOwnProperty(i)&&(p[i]=a[i]);!function(t,i){t.classList.add("countdownHolder");var n="";["Days","Hours","Minutes","Seconds"].map(function(t,i,a){n+='<span class="count'+t+'">',n+='<span class="position">\t\t\t\t\t<span class="digit static">0</span>\t\t\t\t</span>\t\t\t\t<span class="position">\t\t\t\t\t<span class="digit static">0</span>\t\t\t\t</span>',n+="</span>","Seconds"!=t&&(n+='<span class="countDiv countDiv'+i+'"></span>')}),t.innerHTML=n}(n),d=n.querySelectorAll(".position");var u=function(){if((e=Math.floor((p.timestamp-new Date)/1e3))<0)return e=0,void p.callback(s,c,o,r,"end");s=Math.floor(e/86400),updateDuo(0,1,s),e-=86400*s,c=Math.floor(e/3600),updateDuo(2,3,c),e-=3600*c,o=Math.floor(e/60),updateDuo(4,5,o),r=e-=60*o,updateDuo(6,7,r),p.callback(s,c,o,r,"tick"),p.isPause||setTimeout(u,1e3)};updateDuo=function(i,n,a){t($(d[i]),Math.floor(a/10)%10),t($(d[n]),a%10)};return{start:u,pause:function(){p.isPause=!0},reset:function(t){p.timestamp=t,p.isPause=!1,u()},resume:function(){p.timestamp=(new Date).getTime()+1e3*(e+1),p.isPause=!1,u()}}}(document.getElementById("countdown"),{timestamp:(r=60,d=new Date(2012,0,1),new Date>d&&(d=(new Date).getTime()+1e3*r,!1),d),callback:function(t,i,n,a,c){"end"==c&&(e.html(""),s.html("").unbind("click"),_())}}).start()}else{var c=$(a.gamekey);$(".app").prepend(c);var o=$(".cover");$(".buttonx.OK").click(function(t){o.slideUp(350,function(t){o.remove(),_()})}),o.slideDown(350)}else k();var r,d}))},k=function(t){t||(t="<div class='cover'><div class='score'><p class='scr_head'>THÔNG BÁO</p><p class='scr_time'>Khung giờ hiện tại không có áp dụng khuyến mãi Giảm giá!</p><p class='scr_moves'></p><p class='i'>Nhấn OK để tiếp tục trò chơi</p><div class='buttonx OK'>OK</div></div></div>"),u.data("gamekey","-1");var i=$(t);$(".app").prepend(i);var n=$(".cover");$(".buttonx.OK").click(function(t){n.slideUp(350,function(t){n.remove()})}),n.slideDown(350)};function _(){a(),p=!1,n(g),$(".rst").css("display","none"),u.css("display",""),r=[],cardCount=16;for(var t=1;t<=cardCount;t++){var i=t%(cardCount/2)+1;r.push({id:t,type:i,icon:g[i-1],theme:"theme"+i,isKnown:!1,flipped:!1})}n(r),$.each(r,function(t,i){var n=m.clone();n.attr("id","card-"+i.id),$(n.children()[0]).removeClass("khoitao").addClass("front"),$(n.children()[1]).find("span").addClass(i.theme).css({display:"none","background-image":'url("https://caicangcua.github.io/pk8/imgs/'+i.icon+'.png")'}),f.append(n),n.click(function(){if(!i.flipped){o++,i.flipped=!0,c=s,s=i;var t=$(this);if(t.find("span").css({display:"inherit"}),t.flip(!0),s&&c&&s.type===c.type)return $("#card-"+s.id).fadeOut("5000",function(){$(this).remove()}),$("#card-"+c.id).fadeOut("5000",function(){$(this).remove(),p&&v()}),r.splice(r.indexOf(s),1),r.splice(r.indexOf(c),1),s=c=null,d=r.length,void y();if(l.html("Số lần: "+o+", Món: "+d),c)!function(t){setTimeout(function(){r.forEach(function(i){i.id===t&&(i.flipped=!1,i.isKnown=!0)}),$("#card-"+t).flip(!1,function(){$(this).find("span").css({display:"none"})})},800)}(c.id)}})}),s=c=null,d=r.length,$(".app__cards-container__card").flip({axis:"y",trigger:"manual",reverse:!0},function(t){}),v(),w(JSON.stringify({act:"findthesameimg",ncc:"phucky"}),function(t,i){"ok"==t?"OK"==i.kq?u.data("gamekey",i.gamekey):k(i.gamekey):k()})}function w(t,i){$.ajax({retryLimit:0,tryCount:3,url:args.apiURI,type:"POST",contentType:"application/json;charset=utf-8",dataType:"json",cache:!1,timeout:7e3,data:t,success:function(t,n,a){i("ok",t)},error:function(t,n,a){i("err","")}})}$(window).resize(function(){clearTimeout(h),h=setTimeout(function(){v()},500)}),o=0,d=0,setTimeout(function(){_()},100),$(".app__hud__btn-restart").click(function(t){})});