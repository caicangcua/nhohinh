var resizeTimeout,cw=document.querySelectorAll(".cube"),c=document.querySelectorAll(".cube-contain"),overall=document.querySelector('input[id="pickWin"]'),refreshButton=document.querySelector(".modal .refresh"),modalContainer=document.querySelector(".container-modal"),modalClose=document.querySelector(".modal-close"),containerMs=document.querySelector(".modal-tilte"),messageWin=function(){var e=refreshButton.winP;return"OK"==e.kq?(refreshButton.innerHTML="Mời đặt cơm",refreshButton.act="PLACEORDER",e.gamekey.rst):(refreshButton.act="TRYAGAIN",refreshButton.innerHTML="Thử lại","Xin chúc mừng, bạn đã chiến thắng!")},messageLose=function(){return refreshButton.innerHTML="Thử lại",refreshButton.act="TRYAGAIN","Rất tiếc, bạn đã dùng hết 03 lần lật. Bạn muốn thử lại?"},clicks=0,N=180,factor=.5,adjustsize=function(){var e=window.innerWidth,t=window.innerHeight,n=parseInt(Math.sqrt(e*t/16)),o=(e-e%n)/n;if((n=Math.floor(e/(o+1)))<100&&(n=100),n<=250)for(var r=0;r<cw.length;r++)cw[r].style.cssText="width:"+n+"px;height:"+n+"px"};window.addEventListener("resize",function(e){clearTimeout(resizeTimeout),resizeTimeout=setTimeout(function(){adjustsize()},500)});var soundError=new Howl({src:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/953/151309__tcpp__beep1-resonant-error-beep.wav"]}),soundWin=new Howl({src:["https://s3-us-west-2.amazonaws.com/s.cdpn.io/953/391539__mativve__electro-win-sound.wav"]}),soundJingle=new Howl({src:["http://showcase.codethislab.com/games/sweety_memory/sounds/win.mp3"]});function init(){addGift(),adjustsize(),startAnimation(),eventInit()}function eventInit(){[].forEach.call(c,function(e){e.addEventListener("click",function(t){if(++clicks<4&&(openGift(e),document.getElementById("number").innerHTML=3-clicks),3!=clicks||e.classList.contains("win")||(offSelect(),setTimeout(function(){openModal(messageLose(),!1)},800)),e.classList.contains("win")){offSelect(),setTimeout(function(){soundWin.play()},500);var n=2,o=function(){0==--n&&openModal(messageWin(),!0)};dosvr({act:"giftbox_rst",ncc:"phucky",args:[overall.checked?"1":"0",new Date,refreshButton.gamekey]},function(e){refreshButton.winP=e,o()}),setTimeout(function(){o()},1e3)}else setTimeout(function(){soundError.play()},500)},!1)}),overall.addEventListener("change",function(){overall.checked?document.querySelector(".win").classList.add("pseudo-block"):document.querySelector(".win").classList.remove("pseudo-block")},!1),refreshButton.addEventListener("click",function(e){e.preventDefault(),"TRYAGAIN"==refreshButton.act?resetTodo():"PLACEORDER"==refreshButton.act&&args.cb("DATHANG",{kmkey:refreshButton.winP.kmkey})},!1),modalClose.addEventListener("click",function(e){e.preventDefault(),closeModal()},!1)}function startAnimation(){TweenMax.staggerTo(c,1,{rotationX:"-="+N,rotationY:"+="+N,rotationZ:"+="+N,scaleX:1,scaleY:1,scaleZ:1,force3D:!0,ease:Back.easeOut.config(1.7),onComplete:function(){for(var e=0;e<cw.length;e++)cw[e].classList.add("hover-cube")}},.1)}function addGift(){var e=Math.round(Math.random()*(c.length-1));e<=0&&(e=1);for(var t=c[e-1].querySelector(".gift"),n=0;n<c.length;n++){for(var o=c[n].querySelector(".gift");o.firstChild;)o.removeChild(o.firstChild);o.innerHTML="<div>😢</div>"}setTimeout(function(){for(c[e-1].classList.add("win");t.firstChild;)t.removeChild(t.firstChild);t.innerHTML="<div>😎</div>",console.log("You are a curious boy, this is the result "+e)},500)}function openGift(e){var t=new TimelineMax;e.parentElement.classList.add("static-cube"),e.parentElement.classList.remove("hover-cube"),e.classList.add("no-ribbon"),t.to(e.querySelector(".cube-top"),1,{transformOrigin:"right",rotationZ:90,autoAlpha:0,ease:Power2.easeOut}),t.to(e.querySelector(".cube-right"),.5,{transformOrigin:"50% 100%",rotationX:-90,rotationY:90,z:0,ease:Power2.easeOut},"-=0.3"),t.to(e.querySelector(".cube-front"),.5,{transformOrigin:"100% 100%",rotationX:-90,ease:Power2.easeOut},"-=0.3"),t.to(e.querySelector(".cube-back"),.5,{transformOrigin:"100% 100%",rotationX:90,ease:Power2.easeOut},"-=0.3"),t.to(e.querySelector(".cube-left"),.5,{transformOrigin:"50% 100%",rotationX:90,rotationY:90,z:0,ease:Power2.easeOut},"-=0.3"),t.timeScale(2)}function offSelect(){for(var e=0;e<c.length;e++)c[e].classList.add("off"),c[e].parentElement.style.cursor="not-allowed";[].forEach.call(c,function(e){e.removeEventListener("click",function(e){e.preventDefault()},!1)})}function resetTodo(){closeModal(),clicks=0,document.getElementById("number").innerHTML=3;for(var e=0;e<c.length;e++)c[e].classList.remove("off"),c[e].classList.remove("win"),c[e].parentElement.style.cursor="pointer",c[e].parentElement.classList.remove("static-cube"),c[e].classList.remove("no-ribbon"),c[e].parentElement.classList.add("hover-cube"),TweenMax.set(c[e].querySelector(".cube-top"),{clearProps:"all"}),TweenMax.set(c[e].querySelector(".cube-right"),{clearProps:"all"}),TweenMax.set(c[e].querySelector(".cube-front"),{clearProps:"all"}),TweenMax.set(c[e].querySelector(".cube-back"),{clearProps:"all"}),TweenMax.set(c[e].querySelector(".cube-left"),{clearProps:"all"});addGift(),startAnimation()}function openModal(e,t){for(;containerMs.firstChild;)containerMs.removeChild(containerMs.firstChild);containerMs.innerHTML=e,(new TimelineMax).to(modalContainer,.5,{autoAlpha:1}).to(modalContainer.querySelector(".modal"),.5,{y:"0%"}),!0===t&&soundJingle.play()}function closeModal(){containerMs.innerHTML="",overall.checked=!1,document.querySelector(".win").classList.remove("pseudo-block"),(new TimelineMax).to(modalContainer.querySelector(".modal"),.5,{y:"100%"}).to(modalContainer,.5,{autoAlpha:0,onComplete:function(){var e=modalContainer.querySelector(".score");e&&(e.parentNode.removeChild(e),modalContainer.querySelector("#tryagain").style.display="")}})}function dosvr(e,t){var n=new XMLHttpRequest;n.open("POST",args.apiURI,!0),n.setRequestHeader("Content-Type","application/json;charset=utf-8");var o=JSON.stringify(e);n.send(o),n.onload=function(){if(200!=n.status)t({kq:"NG",status:n.status,statusTex:n.statusText});else{var e=JSON.parse(n.responseText);t(e)}},n.onerror=function(e){t({kq:"ERR"})}}var notKM=function(e){dosvr({act:"findthesameimg",ncc:"phucky"},function(t){if(t&&t.kq&&"OK"==t.kq)refreshButton.gamekey=t.gamekey;else{var n=document.createElement("div");t.gamekey?n.innerHTML=t.gamekey:n.innerHTML="<div class='cover'><div class='score'><p class='scr_head'>THÔNG BÁO</p><p class='scr_time'>Khung giờ hiện tại không có áp dụng khuyến mãi Giảm giá!</p><p class='scr_moves'></p><p class='i'>Nhấn OK để tiếp tục trò chơi</p><div class='buttonx OK'>OK</div></div></div>",modalContainer.querySelector(".container-modal .modal").appendChild(n.querySelector(".score")),modalContainer.querySelector("#tryagain").style.display="none",openModal(messageLose(),!1),modalContainer.querySelector(".buttonx.OK").addEventListener("click",function(e){e.preventDefault(),closeModal()},!1)}e&&e()})};notKM(function(){setTimeout(function(){init()},1);var e=document.querySelector(".loading"),t={opacity:0,ease:Linear.ease,onComplete:function(e){var t=document.querySelector("#gamebody");TweenMax.fromTo(t,1,{display:"",opacity:0,ease:Linear.ease},n)}},n={opacity:1};TweenMax.fromTo(e,1,n,t)});